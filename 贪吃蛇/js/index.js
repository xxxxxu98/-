(function(){var Tools={getRandom:function(min,max){var Min=Math.ceil(min);var Max=Math.floor(max);return Math.floor(Math.random()*(max-min+1))+Min}};window.Tools=Tools})();(function(){var foods=[];function Food(map,options){options=options||{};this.left=options.left||0;this.top=options.top||0;this.width=options.width||20;this.height=options.height||20;this.color=options.color||"green";this.position="absolute";this.render=function(){remove();this.left=Tools.getRandom(0,map.offsetWidth/this.width-1);this.top=Tools.getRandom(0,map.offsetHeight/this.height-1);var div=document.createElement("div");map.appendChild(div);foods.push(div);div.style.width=this.width+"px";div.style.height=this.height+"px";div.style.backgroundColor=this.color;div.style.position=this.position;div.style.left=this.left*this.width+"px";div.style.top=this.top*this.height+"px"}}function remove(){for(var i=foods.length-1;i>=0;i--){foods[i].parentNode.removeChild(foods[i]);foods.splice(i,1)}}window.Food=Food})();(function(){var position="absolute";var elements=[];function Snake(map,food,options){options=options||{};this.food=food;this.check=true;this.width=options.width||20;this.height=options.height||20;this.direction="right";this.body=[{x:3,y:2,color:"red"},{x:2,y:2,color:"green"},{x:1,y:2,color:"green"}];this.render=function(){this.move(map);if(this.check){remove();for(var i=1,bodyLength=this.body.length;i<bodyLength;i++){var div=document.createElement("div");map.appendChild(div);elements.push(div);div.style.width=this.width+"px";div.style.height=this.height+"px";div.style.backgroundColor=this.body[i].color;div.style.position=position;div.style.left=this.body[i].x*this.width+"px";div.style.top=this.body[i].y*this.height+"px"}var div=document.createElement("div");map.appendChild(div);elements.push(div);div.style.width=this.width+"px";div.style.height=this.height+"px";div.style.backgroundColor=this.body[0].color;div.style.background='url("./images/kanfu.png")';div.style.position=position;div.style.left=this.body[0].x*this.width+"px";div.style.top=this.body[0].y*this.height+"px"}else{clearInterval(timeId)}}}function remove(){for(var i=elements.length-1;i>=0;i--){elements[i].parentNode.removeChild(elements[i]);elements.splice(i,1)}}Snake.prototype.move=function(map){for(var i=this.body.length-1;i>=1;i--){this.body[i].x=this.body[i-1].x;this.body[i].y=this.body[i-1].y}switch(this.direction){case"top":this.body[0].y-=1;break;case"right":this.body[0].x+=1;break;case"bottom":this.body[0].y+=1;break;case"left":this.body[0].x-=1;break}var xCheck=this.body[0].x<0||this.body[0].x>map.offsetWidth/this.width-1;var yCheck=this.body[0].y<0||this.body[0].y>map.offsetHeight/this.height-1;if(xCheck||yCheck){this.check=false;gameEnd()}for(var i=1,len=this.body.length;i<len;i++){if(this.body[0].x===this.body[i].x&this.body[0].y===this.body[i].y){this.check=false;gameEnd()}}if(this.body[0].x===this.food.left&this.body[0].y===this.food.top){var last=this.body[this.body.length-1];this.body.push({x:last.x,y:last.y,color:"green"});this.food.render();score++}};window.Snake=Snake})();(function(){var that;function Game(){that=this;this.map=document.getElementById("map");this.food=new Food(this.map);this.snake=new Snake(this.map,this.food)}Game.prototype.start=function(){window.score=0;this.food.render();runSnake();bindKey(this.snake)};function runSnake(){window.timeId=setInterval(function(){this.snake.render()}.bind(that),150)}function bindKey(){document.onkeydown=function(e){switch(that.snake.direction){case"left":switch(e.keyCode){case 38:this.snake.direction="top";break;case 40:this.snake.direction="bottom";break}break;case"top":switch(e.keyCode){case 37:this.snake.direction="left";break;case 39:this.snake.direction="right";break}break;case"right":switch(e.keyCode){case 38:this.snake.direction="top";break;case 40:this.snake.direction="bottom";break}break;case"bottom":switch(e.keyCode){case 37:this.snake.direction="left";break;case 39:this.snake.direction="right";break}break}}.bind(that)}window.gameEnd=function(){var surebg=0;var pop=document.getElementsByClassName("pop")[0];document.getElementsByClassName("blockAll")[0].style.display="block";pop.style.display="block";var popWidth=pop.offsetWidth;var score=pop.children[0];score.innerHTML="分数:"+window.score;setInterval(function(){surebg+=3;if(surebg<popWidth){pop.style.backgroundPositionX=surebg+"px"}else{surebg=0}},30)};document.getElementById("sure").onclick=function(){window.location.reload()};window.Game=Game})();(function(){var game=new Game();game.start()})();